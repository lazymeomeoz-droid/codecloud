<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Login - CodeCloud</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-base: #02040a;
      --primary: #6366f1; --accent: #a855f7;
      --glass: rgba(18, 24, 38, 0.6);
      --border: rgba(255, 255, 255, 0.1);
      --text: #f8fafc;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg-base); min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; color: var(--text); }
    
    .aurora-bg { position: fixed; inset: 0; background: radial-gradient(circle at 50% -20%, #1e1b4b, #000 70%); z-index: -1; }
    .orb { position: absolute; width: 600px; height: 600px; background: radial-gradient(circle, rgba(99,102,241,0.15), transparent 70%); border-radius: 50%; animation: float 10s infinite alternate; }
    @keyframes float { 0% { transform: translate(-20%, -20%); } 100% { transform: translate(20%, 20%); } }

    .login-box {
      width: 100%; max-width: 400px; padding: 40px;
      background: var(--glass); backdrop-filter: blur(24px);
      border: 1px solid var(--border); border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
      animation: slideUp 0.5s ease-out;
    }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .logo { width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 16px; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 30px rgba(99,102,241,0.3); }
    .logo svg { width: 32px; height: 32px; color: white; }

    h1 { text-align: center; font-size: 1.5rem; font-weight: 800; margin-bottom: 8px; }
    p.sub { text-align: center; color: #94a3b8; font-size: 0.9rem; margin-bottom: 32px; }

    .tabs { display: flex; background: rgba(255,255,255,0.05); padding: 4px; border-radius: 12px; margin-bottom: 24px; }
    .tab { flex: 1; padding: 10px; border: none; background: transparent; color: #94a3b8; font-weight: 600; border-radius: 8px; cursor: pointer; transition: 0.2s; }
    .tab.active { background: rgba(255,255,255,0.1); color: white; }

    .input-group { margin-bottom: 16px; }
    .input-label { display: block; font-size: 0.85rem; font-weight: 600; color: #cbd5e1; margin-bottom: 8px; }
    .input {
      width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
      border-radius: 12px; color: white; font-size: 0.95rem; outline: none; transition: 0.2s;
    }
    .input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99,102,241,0.2); background: rgba(255,255,255,0.1); }

    .btn {
      width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary), var(--accent));
      border: none; border-radius: 12px; color: white; font-weight: 700; font-size: 1rem; cursor: pointer;
      transition: 0.2s; margin-top: 8px; box-shadow: 0 4px 12px rgba(99,102,241,0.3);
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(99,102,241,0.4); }
    .btn:disabled { opacity: 0.7; cursor: not-allowed; }

    .msg { padding: 12px; border-radius: 10px; font-size: 0.85rem; margin-bottom: 16px; display: none; text-align: center; }
    .msg.error { background: rgba(248,113,113,0.15); color: #f87171; border: 1px solid rgba(248,113,113,0.2); }
    .msg.success { background: rgba(74,222,128,0.15); color: #4ade80; border: 1px solid rgba(74,222,128,0.2); }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="aurora-bg"><div class="orb"></div></div>

  <div class="login-box">
    <div class="logo">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>
    </div>
    <h1>Welcome Back</h1>
    <p class="sub">Enter your credentials to access CodeCloud</p>

    <div class="tabs">
      <button class="tab active" id="t-login">Login</button>
      <button class="tab" id="t-reg">Register</button>
    </div>

    <div id="msg" class="msg"></div>

    <form id="form-login">
      <div class="input-group">
        <label class="input-label">Username</label>
        <input type="text" id="l-user" class="input" required>
      </div>
      <div class="input-group">
        <label class="input-label">Password</label>
        <input type="password" id="l-pass" class="input" required>
      </div>
      <button type="submit" class="btn">Sign In</button>
    </form>

    <form id="form-reg" class="hidden">
      <div class="input-group">
        <label class="input-label">Username</label>
        <input type="text" id="r-user" class="input" placeholder="3-20 characters" required>
      </div>
      <div class="input-group">
        <label class="input-label">Password</label>
        <input type="password" id="r-pass" class="input" placeholder="Min 6 chars" required>
      </div>
      <div class="input-group">
        <label class="input-label">Confirm Password</label>
        <input type="password" id="r-conf" class="input" required>
      </div>
      <button type="submit" class="btn">Create Account</button>
    </form>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const API = '/api/auth';
    
    if(localStorage.getItem('cc_current_user')) location.href='index.html';

    $('#t-login').onclick = () => { toggle(true); };
    $('#t-reg').onclick = () => { toggle(false); };

    function toggle(isLogin) {
      $('#t-login').classList.toggle('active', isLogin);
      $('#t-reg').classList.toggle('active', !isLogin);
      $('#form-login').classList.toggle('hidden', !isLogin);
      $('#form-reg').classList.toggle('hidden', isLogin);
      $('#msg').style.display = 'none';
    }

    function showMsg(txt, type) {
      const m = $('#msg'); m.textContent = txt; m.className = 'msg ' + type; m.style.display = 'block';
    }

    async function auth(action, body) {
      const btn = $(action === 'login' ? '#form-login button' : '#form-reg button');
      const original = btn.textContent;
      btn.disabled = true; btn.textContent = 'Processing...';
      
      try {
        const res = await fetch(API, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({...body, action}) });
        const data = await res.json();
        if(!data.success) throw new Error(data.message);
        
        localStorage.setItem('cc_current_user', JSON.stringify(data.user));
        showMsg('Success! Redirecting...', 'success');
        setTimeout(() => location.href = 'index.html', 800);
      } catch(e) {
        showMsg(e.message, 'error');
        btn.disabled = false; btn.textContent = original;
      }
    }

    $('#form-login').onsubmit = e => {
      e.preventDefault();
      auth('login', { username: $('#l-user').value, password: $('#l-pass').value });
    };

    $('#form-reg').onsubmit = e => {
      e.preventDefault();
      auth('register', { username: $('#r-user').value, password: $('#r-pass').value, confirmPassword: $('#r-conf').value });
    };
  </script>
</body>
</html>